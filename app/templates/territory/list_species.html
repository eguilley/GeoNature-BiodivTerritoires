<div id="listSpecies">
    <h2><i class="fa fa-fw fa-list"></i> Liste des espèces</h2>
    <div class="table-responsive table-responsive-md">
        <table id="listSpeciesTable" class="table table-striped table-hover table-sm table-responsive">
            <thead class="thead-dark">
            <tr>
                <th><i class="fas fa-plus-circle"></i></th>
                <th>group1_inpn</th>
                <th>group2_inpn</th>
                <th>CD Ref</th>
                <th>Nom vernaculaire</th>
                <th>Nom scientifique</th>
                <th>Liste rouge France</th>
                <th>Nombre d'occurences</th>
                <th>Nombre d'observateurs</th>
                <th>Nombre de dates</th>
                <th>Nombre de jeux de données</th>
                <th>Reproduction</th>
                <th>Dernière observation</th>
                <th>Status biologiques</th>

            </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">
    var listSpecieTableDatas = '/api/list_taxa/{{ area_info.id_area }}';

    $(document).ready(function () {
        function format(d) {
            var dataArray = [];
            if (d.properties.last_session != null) {
                dataArray.push('<strong>Dernière session</strong>&nbsp;:&nbsp;' + d.properties.last_session.date_start__max)
            }
            if (d.properties.contact != null) {
                dataArray.push('<strong>Types d&quot;observations</strong>&nbsp;:&nbsp;' + d.properties.contact.contacts)
            }
            if (d.properties.comment != null) {
                dataArray.push('<strong>Commentaire</strong>&nbsp;:&nbsp;' + d.properties.comment)
            }
            if (d.properties.is_managed != null) {
                dataArray.push('<strong>Site géré</strong>')
            }
            if (d.properties.convention != null) {
                dataArray.push('<strong>Convention refuge</strong>')
            }
            return dataArray.join('<br />')
        }

        var listSpeciesTable = $('#listSpeciesTable').DataTable({
            ajax: {
                url: listSpecieTableDatas,
                dataSrc: "datas"
            },
            scrollY: "500px",
            dom: 'Brlftp',
            buttons: {
                buttons: [
                    {extend: 'copy', className: 'btn btn-info'},
                    {
                        extend: 'csvHtml5', className: 'btn btn-info', customize: function (csv) {
                            return "Liste des espèces de {{  area_info.area_name }} ({{ area_info.area_code }})\n\n" + csv;
                        }
                    },
                    {extend: 'pdf', className: 'btn btn-info'},
                ]
            },
            columnDefs: [

                {className: "text-center align-middle", targets: '_all'},
                {
                    "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).css('background-color', 'var(--' + cellData.toLowerCase() + '-color)')
                    }, targets: [6,]
                }
            ],
            createdRow: function (row, data, dataIndex) {
                if (["VU", 'EN', 'CR'].indexOf(data["redlist_nat"]) !== -1) {
                    $(row).addClass('table-danger');
                }
            },
            columns: [
                {
                    "class": "details-control text-center align-middle",
                    "orderable": false,
                    "data": "",
                    "defaultContent": '<a><i class="fa fa-fw fa-plus-circle text-info"></i></a>'
                },
                {data: "group1_inpn"},
                {data: "group2_inpn"},
                {
                    data: function (row) {
                        return '<a href="https://inpn.mnhn.fr/espece/cd_nom/' + row.cd_ref + '" target="_blank" data-toggle="tooltip" title="Fiche de ' + row.nom_vern + '">' + row.cd_ref + '</a>';
                    }
                },
                {data: "nom_vern"},
                {data: "nom_valide"},
                {data: "redlist_nat"},
                {data: "count_occtax"},
                {data: "count_observer"},
                {data: "count_date"},
                {data: "count_dataset"},
                {
                    data: function (row) {
                        var data = null;
                        if (row.reproduction == true) {
                            data = `<i class="fas fa-check-circle text-success"></i><span class="invisible">Oui</span>`;
                        } else (
                            data = ''
                        )
                        ;
                        return data;
                    }
                },
                {data: "last_year"},
                {data: "bio_status"},
            ]
        });
        $('.dt-buttons').addClass('btn-group-sm');
    });
</script>