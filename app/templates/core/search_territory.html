{#<style>#}
{#    .autocomplete-suggestions {#}
{#        border: 1px solid #999;#}
{#        background: #FFF;#}
{#        overflow: auto;#}
{#    }#}
{##}
{#    .autocomplete-suggestion {#}
{#        padding: 2px 5px;#}
{#        white-space: nowrap;#}
{#        overflow: hidden;#}
{#    }#}
{##}
{#    .autocomplete-selected {#}
{#        background: #F0F0F0;#}
{#    }#}
{##}
{#    .autocomplete-suggestions strong {#}
{#        font-weight: normal;#}
{#        color: #3399FF;#}
{#    }#}
{##}
{#    .autocomplete-group {#}
{#        padding: 2px 5px;#}
{#    }#}
{##}
{#    .autocomplete-group strong {#}
{#        display: block;#}
{#        border-bottom: 1px solid #000;#}
{#    }#}
{#</style>#}


<select class="search-territory-select form-control" type="text" placeholder="Rechercher un territoire"
        aria-label="Search"
        style="width:100%;">
</select>
{#<input class="form-control" type="text" name="area" id="autocompleteArea" placeholder="Rechercher un territoire"/>#}


<script>
    // jqueryAutocomplete
    {#$('#autocompleteArea').autocomplete({#}
    {#    serviceUrl: '/api/find/area',#}
    {#    dataType: 'json',#}
    {#    minChars: 3,#}
    {#    deferRequestBy: 250,#}
    {#    paramName: 'q',#}
    {#    groupBy: 'category',#}
    {#    transformResult: function (response) {#}
    {#        return {#}
    {#            suggestions: $.map(response.datas, function (dataItem) {#}
    {#                return {#}
    {#                    value: dataItem.area_name,#}
    {#                    data: dataItem.type_code + '/' + dataItem.area_code,#}
    {#                    datas: dataItem#}
    {#                };#}
    {#            })#}
    {#        };#}
    {#    },#}
    {#    formatResult: function (suggestion) {#}
    {#        var container = '<div><strong>'#}
    {#            + suggestion.datas.area_name#}
    {#            + '&nbsp;('#}
    {#            + suggestion.datas.area_code#}
    {#            + ')&nbsp;<span class="badge badge-sm badge-primary text-right">'#}
    {#            + suggestion.datas.type_name#}
    {#            + '</span></div>';#}
    {#        return container;#}
    {#    },#}
    {#    onSelect: function (suggestion) {#}
    {#        location.href = '/territory/' + suggestion.data;#}
    {#    }#}
    {#});#}

    // Select2 de Recherche de territoire 


    $(".search-territory-select").select2({
        ajax: {
            url: "/api/find/area",
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    q: params.term, // search term
                    page: params.page
                };
            },
            processResults: function (data, params) {
                params.page = params.page || 1;
                return {
                    results: data.datas,
                    pagination: {
                        more: (params.page * 30) < data.total_count
                    }
                };
            },
            cache: true
        },
        theme: 'bootstrap4',
        placeholder: 'Recherchez un territoire',
        minimumInputLength: 3,
        templateResult: formatArea,
        templateSelection: formatAreaSelection
    });

    function formatArea(area) {
        if (area.loading) {
            return area.text;
        }

        var $container = $(
            "<div class='clearfix'>" +
            "<div><strong><span id='select2-result-area__area_name'></span></strong>" +
            "&nbsp;(" +
            "<span id='select2-result-area__area_code'></span>)" +
            "&nbsp;" +
            "<span class='badge badge-primary text-right' id='select2-result-area__type_name'></span></div>" +
            "</div>"
        );

        $container.find("#select2-result-area__area_name").text(area.area_name);
        $container.find("#select2-result-area__type_name").text(area.type_name);
        $container.find("#select2-result-area__area_code").text(area.area_code);

        return $container;
    }

    function formatAreaSelection(area) {
        return area.area_name ? '[' + area.type_name + '] ' + area.area_name + ' (' + area.area_code + ')' : 'Recherchez un territoire';
    }

    $('.search-territory-select').change(function () {
        var data = $(this).val();
        location.href = '/api/area/' + data;
    });


</script>
